apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: provider-certification-task
  namespace: provider-certification
spec:
  params:
  - name: cluster-name
    description: The name of the cluster where the certification will be executed
    type: string
 
  workspaces:
  - name: src
  
  steps:
  - name: certification-run
    workingDir: /workspace/src/$(params.cluster-name)
    image:  quay.io/luzuccar/openshift-provider-cert:v0.0.1
    command:
      - openshift-provider-cert 
    args: 
      - run
    resources:
      limits:
        cpu: 250m
        memory: 1000Mi
      requests:
        cpu: 250m
        memory: 1000Mi
    volumeMounts:
    - name: docker-config
      mountPath: /tmp

  - name: certification-status
    workingDir: /workspace/src/$(params.cluster-name)
    image:  quay.io/luzuccar/openshift-provider-cert:v0.0.1
    command:
      - openshift-provider-cert 
    args: 
      - status
    resources:
      limits:
        cpu: 250m
        memory: 1000Mi
      requests:
        cpu: 250m
        memory: 1000Mi
    volumeMounts:
    - name: docker-config
      mountPath: /tmp

  - name: certification-retrieve
    workingDir: /workspace/src/$(params.cluster-name)
    image:  quay.io/luzuccar/openshift-provider-cert:v0.0.1
    command:
      - openshift-provider-cert 
    args: 
      - retrieve 
      - $(params.cluster-name) 
    resources:
      limits:
        cpu: 250m
        memory: 1000Mi
      requests:
        cpu: 250m
        memory: 1000Mi
    volumeMounts:
    - name: docker-config
      mountPath: /tmp

  volumes:
  - name: docker-config
    configMap:
      name: docker-config

